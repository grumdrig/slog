<!doctype html>
<head>
<style>
	canvas { border: solid 1px red }
	span { display: inline-block }
</style>
</head>
<body>

<canvas></canvas>
<span id=pen>FOREGROUND COLOR</span>
<span id=palette></span>
<pre id=coded></pre>

<script>

function $(s) { return document.querySelector(s) }

let can = $('canvas');
let D = 64;
let data;// = new Array(D*D).fill(0);

can.width = can.height = 512;

const colors = {
	DEEPS: 'darkblue',
	SHALLOWS: 'blue',
	BEACH: 'cornsilk',
	PLAIN: 'lawngreen',
	DESERT: 'sandybrown',
	HILLS: 'chocolate',
	MOUNTAINS: 'brown',
	GLACIER: 'lightcyan',
	MIXED_FOREST: 'forestgreen',
	SCRUB_FOREST: 'yellowgreen',
	EVERGREEN_FOREST: 'darkgreen',
	DECIDIOUS_FOREST: 'olive',
	RIVER: 'turquoise',
	BRIDGE: 'purple',
	TOWN: 'fuchsia',
	TUNDRA: 'silver',
	MARSH: 'teal',
};

const CODES = "Ww._#mM@ftFT=^!~v";

const terrains = Object.keys(colors);
const NUM_TERRAINS = terrains.length;

for (let c = 0; c < NUM_TERRAINS; ++c) {
	colors[c] = colors[terrains[c]];
	terrains[terrains[c]] = c;

	let b = document.createElement('button');
	b.style.backgroundColor = colors[c];
	b.innerText = terrains[c];
	$('#palette').appendChild(b);
	b.onclick = e => setPen(c);

	$('#palette').appendChild(document.createElement('br'));
}

let PEN = terrains.PLAIN;
setPen(PEN);

function setPen(value) {
	PEN = value;
	$('#pen').style.backgroundColor = colors[PEN];
	$('#pen').innerText = terrains[value];
}


function draw() {
	let coded = "";
	let zoom = can.width / D;
	let ctx = can.getContext('2d');
	for (let lat = 0; lat < D; ++lat) {
		for (let long = 0; long < D; ++long) {
			let index = lat * D + long;
			let x = zoom * long;
			let y = zoom * lat;
			ctx.fillStyle = colors[data[index]];
			ctx.fillRect(x, y, zoom, zoom);
			coded += CODES[data[index]];
		}
		coded += "\n";
	}
	$("#coded").innerText = coded;
}

can.addEventListener('mousedown', paint);
can.addEventListener('mousemove', paint);

function paint(e) {
	let zoom = can.width / D;
	if (!e.buttons) return;
	let x = e.offsetX;
	let y = e.offsetY;
	let long = Math.floor(x / zoom);
	let lat = Math.floor(y / zoom);
	if (0 <= long && long < D && 0 <= lat && lat < D) {
		let index = lat * D + long;
		data[index] = PEN;
		draw();
		save();
	}
}

function reset(c) {
	data = new Array(D*D).fill(c || 0);
	draw();
}


function save() {
	localStorage.data = JSON.stringify(data);
}

function load() {
	try {
		data = JSON.parse(localStorage.data);
		D = Math.floor(Math.sqrt(data.length));
	} catch {
		reset(0);
	}
	draw();
}

load();
// data = data.map(_ => Math.floor(Math.random() * NUM_TERRAINS));



</script>