<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>PQ Slog: Bompton Island</title>
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="height: 512px; width: 512px;"><path d="M0 0h512v512H0z" fill="black" fill-opacity="1"></path><g class="" transform="translate(0,0)" style=""><path d="M19.75 14.438c59.538 112.29 142.51 202.35 232.28 292.718l3.626 3.75.063-.062c21.827 21.93 44.04 43.923 66.405 66.25-18.856 14.813-38.974 28.2-59.938 40.312l28.532 28.53 68.717-68.717c42.337 27.636 76.286 63.646 104.094 105.81l28.064-28.06c-42.47-27.493-79.74-60.206-106.03-103.876l68.936-68.938-28.53-28.53c-11.115 21.853-24.413 42.015-39.47 60.593-43.852-43.8-86.462-85.842-130.125-125.47-.224-.203-.432-.422-.656-.625C183.624 122.75 108.515 63.91 19.75 14.437zm471.875 0c-83.038 46.28-154.122 100.78-221.97 161.156l22.814 21.562 56.81-56.812 13.22 13.187-56.438 56.44 24.594 23.186c61.802-66.92 117.6-136.92 160.97-218.72zm-329.53 125.906l200.56 200.53c-4.36 4.443-8.84 8.793-13.405 13.032L148.875 153.53l13.22-13.186zm-76.69 113.28l-28.5 28.532 68.907 68.906c-26.29 43.673-63.53 76.414-106 103.907l28.063 28.06c27.807-42.164 61.758-78.174 104.094-105.81l68.718 68.717 28.53-28.53c-20.962-12.113-41.08-25.5-59.937-40.313 17.865-17.83 35.61-35.433 53.157-52.97l-24.843-25.655-55.47 55.467c-4.565-4.238-9.014-8.62-13.374-13.062l55.844-55.844-24.53-25.374c-18.28 17.856-36.602 36.06-55.158 54.594-15.068-18.587-28.38-38.758-39.5-60.625z" fill="white" fill-opacity="1"></path></g></svg>' />
<link rel=stylesheet href="node_modules/xp.css/dist/XP.css">
<link rel=stylesheet href="os.css">
<script src="vm.js"></script>
<script src="os.js"></script>
<script src="bompton.js"></script>
<style>
#newstuff {
	min-width: 240px;
	display: grid;
	grid-template-columns: 40px 1fr;
}
#newstuff > fieldset {
	grid-column: 1/3;
	background-color: transparent;
}
#strat-author, #strat-title {
	background: white;
	padding: 2px;
	border: solid 1px rgb(208,208,191);
	border-radius: 4px;
}
#strat-desc {
	width: 200px;
}
#sold {
	grid-column: 1/3;
	text-align: center;
	margin-top: 4px;
}
fieldset > .field-row {
	margin-top: 4px;
	margin-bottom: 4px;
}
</style>
</head>
<body>

<div class=window hidden id=game-window>
	<div class="title-bar">
		<div class="title-bar-text">Loading...</div>
		<div class="title-bar-controls">
			<button aria-label="Close" class=close></button>
		</div>
	</div>

	<div class=window-body></div>
</div>

<div class=window id=newgame-window>
	<div class="title-bar">
		<div class="title-bar-text">New Game</div>
		<div class="title-bar-controls">
			<button aria-label="Close" class=close></button>
		</div>
	</div>
	<div class=window-body>
		<div id=newstuff>
			<label for=name>Name</label><input type=text id=name></input>
			<fieldset style="margin-top:10px">
				<legend>Strategy</legend>
				<div class=field-row>
					<select name=strat id=strat>
						<option selected>-- Pick a strat --</option>
						<option value='grumdrig.bin'>Grumdrig</option>
						<option><i>[ Upload... ]</i></option>
					</select>
					<button onclick="document.getElementById('chooser').classList.add('field-row')">Upload...</button>
				</div>
				<div id=chooser hidden class=XXfield-row>
					<input type="file" name="client-file" id="get-files" accept=".strat" />
				</div>
				<div class=field-row style="margin-top:16px;display:grid;grid-template-columns:1fr 4fr">
					<label for=strat-title>Title</label><div id=strat-title>&nbsp;</div>
					<label for=strat-author style=margin-left:0>Author</label><div id=strat-author>&nbsp;</div>
				</div>
				<fieldset class=field-row style="grid-column:1/3">
						<legend>Description</legend>
						<div class=field-row id=strat-desc>&nbsp;</div>
				</fieldset>
			</fieldset>
			<div id=sold><button onclick="sold()">Go!</button></div>
		</div>
	</div>
</div>

<div class=window hidden id=map-window>
	<div class="title-bar">
		<div class="title-bar-text">Map</div>
		<div class="title-bar-controls">
			<button aria-label="Close" class=close></button>
		</div>
	</div>

	<div class="window-body">
		<img src=bompton_map.png width=800px></img>
	</div>
</div>



<div class=icon data-for=game-window>
	<img src=game.png>
	<div>Game</div>
</div>

<div class=icon data-for=newgame-window>
	<img src=game.png>
	<div>New Game</div>
</div>

<div class=icon data-for=map-window>
	<img src=map.png>
	<div>Map</div>
</div>

<script>

let vm;


//hide("#chooser");

window.addEventListener('load', e => {
	let game = Bompton;
	$("#game-window .title-bar-text").innerHTML = game.title;
	$("#game-window .window-body").innerHTML = game.windowContent;

	prepOS();

	show('#newgame-window');
	hide('#game-window');

	$("input[type=file]").addEventListener('change', upload);
});

let PACKAGE;

function upload(e) {
	let f = e.target.files[0];
	if (f) loadPackage(f.name, package => {
		PACKAGE = package;
		$("#strat-title").innerText = package.title || '(untitled)';
		$("#strat-author").innerText = package.author || '(anonymous)';
		$("#strat-desc").innerText = package.description || '(no description)';
	});
}

function sold() {
	hide('#newgame-window');

	// loadBinary($('#orders').value, program => {
	// 	vm = new VirtualMachine(program, Bompton);
	// 	play();
	// });
	vm = new VirtualMachine(PACKAGE.binary, Bompton);
	play();

}


function play() {
	show($id('game-window'));
	bringToFront($id('game-window'));
	// vm.running = true;
	Bompton.playmation(vm);
}



</script>